generator client {
    provider = "prisma-client-js"
    output   = "../generated/prisma"
}

datasource db {
    provider  = "postgresql"
    url       = env("SUPABASE_URL")
    directUrl = env("SUPABASE_DIRECT_URL")
}

model SeedHistory {
    name       String   @unique
    executedAt DateTime @default(now())

    @@map("_prisma_seed_history")
}

model User {
    id         BigInt   @id @default(autoincrement())
    name       String   @db.VarChar
    email      String   @unique @db.VarChar
    role       UserRole @default(USER)
    created_at DateTime @default(now()) @db.Timestamptz(6)
    uid        String?

    organizerProfile   OrganizerProfile?
    institutionProfile InstitutionProfile?
    createdEvents      Event[]
    createdLocations   Location[]

    @@map("users")
}

model OrganizerProfile {
    id     BigInt @id @default(autoincrement())
    userId BigInt @unique

    user User @relation(fields: [userId], references: [id])

    @@map("organizer_profiles")
}

model InstitutionProfile {
    id          BigInt  @id @default(autoincrement())
    userId      BigInt  @unique
    description String?
    website     String?

    user User @relation(fields: [userId], references: [id])

    @@map("institution_profiles")
}

model Category {
    id          BigInt            @id @default(autoincrement())
    name        String            @db.VarChar
    description String?           @db.VarChar
    created_at  DateTime          @default(now()) @db.Timestamptz(6)
    events      EventCategories[]

    @@map("categories")
}

model Event {
    id          BigInt            @id @default(autoincrement())
    title       String            @db.VarChar
    description String?           @db.VarChar
    start_time  DateTime          @db.Timestamp(6)
    end_time    DateTime?         @db.Timestamp(6)
    location    String?           @db.VarChar
    lat         Float?            @db.DoublePrecision
    lng         Float?            @db.DoublePrecision
    created_at  DateTime          @default(now()) @db.Timestamptz(6)
    image_url   String?           @db.VarChar
    location_id BigInt?
    creator_id  BigInt
    categories  EventCategories[]
    creator     User              @relation(fields: [creator_id], references: [id])
    Location    Location?         @relation(fields: [location_id], references: [id])

    @@map("events")
}

model EventCategories {
    id          BigInt @id @default(autoincrement())
    event_id    BigInt
    category_id BigInt

    category Category @relation(fields: [category_id], references: [id])
    event    Event    @relation(fields: [event_id], references: [id], onDelete: Cascade)

    @@map("event_categories")
}

enum UserRole {
    USER
    ORGANIZER
    INSTITUTION
}

model Location {
    id          BigInt   @id @default(autoincrement())
    name        String
    address     String
    city        String
    lat         Float
    lng         Float
    description String?
    phone       String?
    email       String?
    website     String?
    image_url   String?
    creator_id  BigInt
    created_at  DateTime @default(now()) @db.Timestamptz(6)
    creator     User     @relation(fields: [creator_id], references: [id])
    events      Event[]

    @@map("locations")
}
